name: unittests
on: [push, pull_request]
jobs:
  unittests:
    name: "Python unit tests"
    runs-on: ubuntu-latest
    steps:
      - name: "Check out repository"
        uses: actions/checkout@v4
      - run: "pip3 install -r test/requirements.txt --user"
      - run: "python3 -m unittest"
      - run: "importchecker sigridci"
  feedback_smoketest:
    name: "Sigrid CI on-premise smoke test"
    runs-on: ubuntu-latest
    steps:
      - name: "Check out repository"
        uses: actions/checkout@v4
      - run: >
          python3 sigridci/sigridci_feedback.py \
            --customer example \
            --system junit \
            --capability maintainability \
            --analysisresults test/testdata/maintainability.json
          cat sigrid-ci-output/feedback.md
  compatibility-check:
    name: "Python compatibility check"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.9", "3.13"]
    steps:
      - name: "Check out repository"
        uses: actions/checkout@v4
      - name: "Set up Python ${{ matrix.python-version }}"
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}
      - name: "Check compatibility with Python version"
        run: |
          python -m compileall -f sigridci
          cd sigridci && python -c "import sigridci; print('Import successful for Python ${{ matrix.python-version }}')"